<div class="flex flex-col sm:flex-row gap-4">
  <div @fadeInUp class="flex-auto">
    <mat-divider class="-mr-6 -ml-6"></mat-divider>
    <div class="py-4 flex flex-col">
      <div class="flex flex-col sm:flex-row sm:gap-4">
        <form [formGroup]="formGroup" class="w-full">
          <div class="flex flex-col sm:flex-row sm:gap-4">
            <mat-form-field class="flex-auto">
              <mat-label>N° Expediente</mat-label>
              <input matInput formControlName="nroExpediente" />
            </mat-form-field>
            <mat-form-field class="flex-auto">
              <mat-label>Contratista</mat-label>
              <input type="text" matInput formControlName="contratista" [matAutocomplete]="autoContratista" />
              <mat-autocomplete #autoContratista="matAutocomplete" [displayWith]="displayContratista">
                <mat-option *ngFor="let obj of filteredContratistas | async" [value]="obj">
                  {{ obj.valor }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>

            <mat-form-field class="flex-auto">
              <mat-label>Tipo de Contrato</mat-label>
              <mat-select formControlName="tipoSolicitud">
                <mat-option *ngFor="let obj of listTipoSolicitud" [value]="obj">
                  {{ obj.nombre }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="flex flex-col sm:flex-row sm:gap-4">
            <mat-form-field class="flex-1">
              <mat-label>Tipo Aprobación</mat-label>
              <mat-select formControlName="tipoAprobacion">
                <mat-option *ngFor="let obj of listTipoAprobacionP" [value]="obj">
                  {{ obj.nombre }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field class="flex-1">
              <mat-label>Estado Aprobación</mat-label>
              <mat-select formControlName="estadoAprobacion">
                <mat-option *ngFor="let obj of listEstadoAprobacionP" [value]="obj">
                  {{ obj.nombre }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <div class="flex-1"></div>
          </div>

        </form>
        <div class="flex-auto"></div>
      </div>
      <div class="flex flex-col sm:flex-row sm:gap-2 items-center justify-end">
        <button color="primary" style="margin-right: auto;" mat-raised-button type="button"
          (click)="aprobarPersonal(usuario)">Aprobar/Visto Bueno/Firmar</button>
        <button color="primary" mat-raised-button type="button" (click)="buscar()">
          Buscar
        </button>
        <button color="primary" mat-raised-button type="button" (click)="limpiar()">
          Limpiar
        </button>
      </div>
    </div>
  </div>
</div>
<div class="overflow-auto shadow-2xl rounded">
  <table class="w-full border" mat-table matSort [dataSource]="dataSourceReemplazar">
    <ng-container matColumnDef="tipoAprobacion">
      <th mat-header-cell *matHeaderCellDef style="text-align: center;">Tipo Aprobación</th>
      <td mat-cell *matCellDef="let element">
        <mat-checkbox color="primary" (change)="actualizarListaExpedientePersonal($event, element)">
        </mat-checkbox>&nbsp;
        {{ element.nomTipoAprobacion }}
      </td>
    </ng-container>

    <ng-container matColumnDef="numeroExpediente">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Número <br>Expediente</th>
      <td mat-cell *matCellDef="let element">
        {{ element.numeroExpediente }}
      </td>
    </ng-container>

    <ng-container matColumnDef="documento">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        {{ tipousuario.EVALUADOR ? 'Documento' : 'Informe' }}
      </th>
      <td mat-cell *matCellDef="let element">
        <div style="display: flex; align-items: center;">
          <span>{{ element.informe }}</span>
          <button mat-icon-button type="button">
            <mat-icon (keyup)="$event.preventDefault()" (click)="descargar(element.idArchivo, element.informe)">get_app</mat-icon>
          </button>
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="tp">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>TP</th>
      <td mat-cell *matCellDef="let element">{{ element.tp }}</td>
    </ng-container>

    <ng-container matColumnDef="contratista">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Contratista</th>
      <td mat-cell *matCellDef="let element">{{ element.contratista }}
      </td>
    </ng-container>

    <ng-container matColumnDef="tipoSolicitud" *ngIf="!tipousuario.EVALUADOR">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Tipo de <br>Solicitud</th>
      <td mat-cell *matCellDef="let element">{{ element.tipoSolicitud }}</td>
    </ng-container>

    <ng-container matColumnDef="tipoSolicitud" *ngIf="tipousuario.EVALUADOR">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Tipo de <br>Contrato</th>
      <td mat-cell *matCellDef="let element">{{ element.tipoSolictiud }}</td>
    </ng-container>

    <ng-container matColumnDef="fechaIngreso">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha Ingreso</th>
      <td mat-cell *matCellDef="let element">{{ element.fechaIngreso }}</td>
    </ng-container>

    <ng-container matColumnDef="estadoAprobacion">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado <br>Aprobación</th>
      <td mat-cell *matCellDef="let element">{{ element.esAprob }}</td>
    </ng-container>

    <ng-container matColumnDef="estadoAprobacionLogistica">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado Aprobación <br>Logística</th>
      <td mat-cell *matCellDef="let element">{{ element.estadoAprobLogistica }}</td>
    </ng-container>

    <ng-container matColumnDef="estadoVbGAF">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado VB <br>GAF</th>
      <td mat-cell *matCellDef="let element">{{ element.estadoVistoBuenoGaf }}</td>
    </ng-container>

    <ng-container matColumnDef="estadoFirma">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado Firma <br>Jefe Unidad</th>
      <td mat-cell *matCellDef="let element">{{ element.estadoFirmaJefe }}</td>
    </ng-container>

    <ng-container matColumnDef="estadoFirmaGe">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado Firma <br>Gerente</th>
      <td mat-cell *matCellDef="let element">{{ element.estadoFirmaGerencia }}</td>
    </ng-container>

    <ng-container matColumnDef="actionsPersonal" *ngIf="rol===roles.APROBADOR_G4">
      <th *matHeaderCellDef mat-header-cell mat-sort-header>Acciones</th>
      <td *matCellDef="let row" class="w-10 text-secondary" mat-cell>
        <button (click)="$event.stopPropagation()" [matMenuTriggerData]="{ row: row }"
          [matMenuTriggerFor]="actionsPersonal" mat-icon-button type="button">
          <mat-icon svgIcon="mat:more_horiz"></mat-icon>
        </button>
      </td>
    </ng-container>
    <ng-container matColumnDef="actionsPersonal" *ngIf="rol!==roles.APROBADOR_G4">
      <th *matHeaderCellDef mat-header-cell mat-sort-header>Acciones</th>
      <td *matCellDef="let row" class="w-10 text-secondary" mat-cell>
        <button mat-icon-button type="button">
          <mat-icon svgIcon="mat:more_horiz"></mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumnsPersonal"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumnsPersonal"></tr>

    <ng-container matColumnDef="loadingPersonal">
      <td mat-footer-cell *matFooterCellDef colspan="12" class="text-center">Cargando Datos...</td>
    </ng-container>

    <ng-container matColumnDef="vacioPersonal">
      <td mat-footer-cell *matFooterCellDef colspan="12" class="text-center text-primary">No se
        encuentran resultados para los filtros seleccionados</td>
    </ng-container>

    <tr mat-footer-row *matFooterRowDef="['vacioPersonal']"
      [ngClass]="{ hide: !(dataSourceReemplazar.data.length === 0) }"></tr>
  </table>
  <mat-paginator #paginatorReemplazar class="sticky left-0" [pageSizeOptions]="[10, 20, 30]" (page)="pageChange($event)"
    showFirstLastButtons></mat-paginator>
</div>

<mat-menu #actionsPersonal="matMenu" xPosition="before" yPosition="below">
  <ng-template let-row="row" matMenuContent>
    <button mat-menu-item (click)="historyApproveAndSignPersonal(row)">
      <mat-icon svgIcon="mat:history"></mat-icon>
      <span>Historial Aprobar y firmar</span>
    </button>
  </ng-template>
</mat-menu>