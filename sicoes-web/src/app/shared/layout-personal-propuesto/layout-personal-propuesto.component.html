<div class="w-full overflow-x-auto rounded items-center mb-6 mt-4" *ngIf="isReview || isReviewExt || isCargaAdenda">
  <table @stagger [dataSource]="listPersonalAgregado" class="w-full table-auto" mat-table matSort>
    <ng-container matColumnDef="tipoDocumento">
      <th mat-header-cell *matHeaderCellDef mat-sort-header class="text-left">Tipo de<br>Documento</th>
      <td class="text-primary font-medium" mat-cell *matCellDef="let element">{{ element?.tipoDocumento }}</td>
    </ng-container>

    <ng-container matColumnDef="numeroDocumento">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Número de<br>Documento</th>
      <td class="text-primary font-medium" mat-cell *matCellDef="let element">{{ element?.numeroDocumento }}</td>
    </ng-container>

    <ng-container matColumnDef="nombreCompleto">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombres y apellidos</th>
      <td class="text-primary font-medium break-words whitespace-normal min-w-[80px] py-2" mat-cell *matCellDef="let element">{{ element?.nombreCompleto }}</td>
    </ng-container>

    <ng-container matColumnDef="vacio">
      <td mat-footer-cell *matFooterCellDef colspan="9"
      class="text-center text-primary">
      No se encontraron registros
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumnsReview"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumnsReview"></tr>

    <tr mat-footer-row *matFooterRowDef="['vacio']"
      [class.hidden]="listPersonalAgregado?.length > 0">
    </tr>
  </table>
</div>

<div class="flex flex-col sm:flex-row sm:gap-4 mt-4 items-start" *ngIf="!(isReview || isReviewExt || isCargaAdenda)">
  <mat-form-field class="flex-auto">
    <mat-label>Nombres y Apellidos</mat-label>
    <mat-select [formControl]="formGroup.controls.nombreCompleto">
      <mat-option [value]="null" [disabled]>Seleccione personal</mat-option>
      <mat-option *ngFor="let obj of listPersonalPropuesto" [value]="obj">
        {{ obj.nombreCompleto }}
      </mat-option>
    </mat-select>
    <mat-error *ngIf="formGroup.get('nombreCompleto')?.hasError('required')">
      Seleccione personal
    </mat-error>
  </mat-form-field>
  <button color="primary" mat-raised-button type="button">Agregar</button>
</div>
<div *ngFor="let personal of listPersonalPropuesto">
    <ng-container [ngTemplateOutletContext]="{ otro: personal }" [ngTemplateOutlet]="templateNepotismo"></ng-container>
    <ng-container [ngTemplateOutletContext]="{ otro: personal }" [ngTemplateOutlet]="templateImpedimento"></ng-container>
    <ng-container [ngTemplateOutletContext]="{ otro: personal }" [ngTemplateOutlet]="templateNoVinculo"></ng-container>
    <ng-container [ngTemplateOutletContext]="{ otro: personal }" [ngTemplateOutlet]="templateOtros"></ng-container>
</div>

<div class="w-full overflow-x-auto shadow-2xl rounded" *ngIf="!(isReview || isReviewExt || isCargaAdenda)">
    <table @stagger [dataSource]="listPersonalAgregado" class="w-full table-auto" mat-table matSort>
      <ng-container matColumnDef="tipoDocumento">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Tipo de<br>Documento</th>
        <td class="text-primary font-medium" mat-cell *matCellDef="let element">{{ element?.tipoDocumento }}</td>
      </ng-container>

      <ng-container matColumnDef="numeroDocumento">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Número de<br>Documento</th>
        <td class="text-primary font-medium" mat-cell *matCellDef="let element">{{ element?.numeroDocumento }}</td>
      </ng-container>

      <ng-container matColumnDef="nombreCompleto">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombres y apellidos</th>
        <td class="text-primary font-medium break-words whitespace-normal min-w-[100px] py-2" mat-cell *matCellDef="let element">{{ element?.nombreCompleto }}</td>
      </ng-container>

      <ng-container matColumnDef="djNepotismo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>DJ del personal<br>propuesto por la<br>empresa (Nepotismo)</th>
        <td class="text-primary font-medium" mat-cell *matCellDef="let element">{{ element?.perfil }}</td>
      </ng-container>

      <ng-container matColumnDef="djImpedimento">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>DJ impedimentos /<br>incompatibilidad y<br>prohibiciones</th>
        <td class="text-primary font-medium" mat-cell *matCellDef="let element">{{ element?.fechaRegistro }}</td>
      </ng-container>

      <ng-container matColumnDef="djNoVinculo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>DJ no vínculo<br>contractual con<br>agente supervisado</th>
        <td class="text-primary font-medium" mat-cell *matCellDef="let element">{{ element?.fechaInicioContractual }}</td>
      </ng-container>

      <ng-container matColumnDef="otrosDocumentos">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Otros<br>documentos</th>
        <td class="text-primary font-medium" mat-cell *matCellDef="let element">{{ element?.estadoReemplazo }}</td>
      </ng-container>

      <!-- Action Column -->

      <ng-container matColumnDef="actions">
        <th *matHeaderCellDef mat-header-cell mat-sort-header>Acciones</th>
        <td *matCellDef="let row" class="w-10 text-secondary" mat-cell>
        </td>
      </ng-container>

      <ng-container matColumnDef="vacio">
        <td mat-footer-cell *matFooterCellDef colspan="9"
        class="text-center text-primary">
        No se encontraron registros
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <tr mat-footer-row *matFooterRowDef="['vacio']"
        [class.hidden]="listPersonalAgregado?.length > 0">
      </tr>
    </table>
</div>

<ng-template #templateNepotismo let-otro="otro">
  <div class="flex items-center w-full">
    <mat-checkbox color="primary" 
      (change)="setValueCheckedDjNepotismo(formGroup, $event)"
      [disabled] = "isCargaAdenda || rolePermisoCheckBox?.hasPermission"
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME"
      #rolePermisoCheckBox="vexOptionRoleCheck">
      <span>DJ del personal propuesto por la empresa (Nepotismo)</span>
    </mat-checkbox>
    <span class="flex-1"></span>
    <span class="text-secondary" *ngIf="isReview || isReviewExt || isCargaAdenda">DjMock.pdf</span>
    <button *ngIf="isReview || isReviewExt || !isCargaAdenda" matTooltip="Descargar"
      mat-icon-button type="button"
      class="text-primary hover:bg-hover">
      <mat-icon svgIcon="mat:download" size="18px"></mat-icon>
    </button>
    <mat-radio-group
      [disabled] = "isCargaAdenda"
      *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME"
      [(ngModel)]="marcaDjNepotismo"
      class="ml-12 flex items-center gap-4">
      <mat-radio-button value="si">Sí</mat-radio-button>
      <mat-radio-button value="no">No</mat-radio-button>
    </mat-radio-group>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12">Evaluado por:</span>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12">Fecha y Hora:</span>
    <ng-container 
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME" 
      #rolePermisoSpan="vexOptionRoleCheck">
      <span *ngIf="!(rolePermisoSpan?.hasPermission)" class="flex-1">
      </span>
    </ng-container>

    <vex-form-adjuntos-btn *ngIf="!(isReview || isReviewExt || isCargaAdenda)"
      class="ml-auto"
      [titulo]="'Archivo (*.pdf)'"
      [editable]="editable">
    </vex-form-adjuntos-btn>
  </div>
  <div *vexOptionRoleReemplazo="opcion.VIEW_OBS_INPUT"> 
    <mat-form-field class="w-full">
      <textarea matInput
             placeholder="Observación"
             [disabled] = "isCargaAdenda || !rolePermiso?.hasPermission"
             [vexOptionRoleCheck]="opcion.EDIT_OBS_INPUT"
             #rolePermiso="vexOptionRoleCheck"
             rows="2"
             cdkTextareaAutosize
             cdkAutosizeMinRows="2"
             cdkAutosizeMaxRows="5"></textarea>
    </mat-form-field>
  </div>
</ng-template>


<ng-template #templateImpedimento let-otro="otro">
  <div class="flex items-center w-full">
    <mat-checkbox color="primary"
      (change)="setValueCheckedDjImpedimento(formGroup, $event)"
      [disabled] = "isCargaAdenda || rolePermisoCheckBox?.hasPermission"
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME"
      #rolePermisoCheckBox="vexOptionRoleCheck">
      <span>DJ impedimentos / incompatibilidad y prohibiciones</span>
    </mat-checkbox>
    <span class="flex-1"></span>
    <span class="text-secondary" *ngIf="isReview || isReviewExt || isCargaAdenda">DjMock.pdf</span>
    <button *ngIf="isReview || isReviewExt || !isCargaAdenda" matTooltip="Descargar"
      mat-icon-button type="button"
      class="text-primary hover:bg-hover">
      <mat-icon svgIcon="mat:download" size="18px"></mat-icon>
    </button>
    <mat-radio-group
      *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME"
      [disabled] = "isCargaAdenda"
      [(ngModel)]="marcaDjImpedimento"
      class="ml-12 flex items-center gap-4">
      <mat-radio-button value="si">Sí</mat-radio-button>
      <mat-radio-button value="no">No</mat-radio-button>
    </mat-radio-group>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12">Evaluado por:</span>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12">Fecha y Hora:</span>
    <ng-container 
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME" 
      #rolePermisoSpan="vexOptionRoleCheck">
      <span *ngIf="!(rolePermisoSpan?.hasPermission)" class="flex-1">
      </span>
    </ng-container>

    <vex-form-adjuntos-btn class="ml-6" *ngIf="!(isReview || isReviewExt || isCargaAdenda)"
        [titulo]="'Archivo (*.pdf)'"
        [editable]="editable">
    </vex-form-adjuntos-btn>
  </div>
  <div *vexOptionRoleReemplazo="opcion.VIEW_OBS_INPUT"> 
    <mat-form-field class="w-full">
      <textarea matInput
             placeholder="Observación"
             [disabled] = "isCargaAdenda || !rolePermiso?.hasPermission"
             [vexOptionRoleCheck]="opcion.EDIT_OBS_INPUT"
             #rolePermiso="vexOptionRoleCheck"
             rows="2"
             cdkTextareaAutosize
             cdkAutosizeMinRows="2"
             cdkAutosizeMaxRows="5"></textarea>
    </mat-form-field>
  </div>
</ng-template>

<ng-template #templateNoVinculo let-otro="otro">
  <div class="flex items-center w-full">
    <mat-checkbox color="primary" 
      (change)="setValueCheckedDjNoVinculo(formGroup, $event)"
      [disabled] = "isCargaAdenda || rolePermisoCheckBox?.hasPermission"
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME"
      #rolePermisoCheckBox="vexOptionRoleCheck">
      <span>DJ no vínculo contractual con agente supervisado</span>
    </mat-checkbox>
    <span class="flex-1"></span>
    <span class="text-secondary" *ngIf="isReview || isReviewExt || isCargaAdenda">DjMock.pdf</span>
    <button *ngIf="isReview || isReviewExt || !isCargaAdenda" matTooltip="Descargar"
      mat-icon-button type="button"
      class="text-primary hover:bg-hover">
      <mat-icon svgIcon="mat:download" size="18px"></mat-icon>
    </button>
    <mat-radio-group
      *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME"
      [disabled] = "isCargaAdenda"
      [(ngModel)]="marcaDjNoVinculo"
      class="ml-12 flex items-center gap-4">
      <mat-radio-button value="si">Sí</mat-radio-button>
      <mat-radio-button value="no">No</mat-radio-button>
    </mat-radio-group>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12">Evaluado por:</span>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12">Fecha y Hora:</span>
    <ng-container 
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME" 
      #rolePermisoSpan="vexOptionRoleCheck">
      <span *ngIf="!(rolePermisoSpan?.hasPermission)" class="flex-1">
      </span>
    </ng-container>

    <vex-form-adjuntos-btn class="ml-6" *ngIf="!(isReview || isReviewExt || isCargaAdenda)"
      [titulo]="'Archivo (*.pdf)'"
      [editable]="editable">
    </vex-form-adjuntos-btn>
  </div>
  <div *vexOptionRoleReemplazo="opcion.VIEW_OBS_INPUT"> 
    <mat-form-field class="w-full">
      <textarea matInput
             placeholder="Observación"
             [disabled] = "isCargaAdenda || !rolePermiso?.hasPermission"
             [vexOptionRoleCheck]="opcion.EDIT_OBS_INPUT"
             #rolePermiso="vexOptionRoleCheck"
             rows="2"
             cdkTextareaAutosize
             cdkAutosizeMinRows="2"
             cdkAutosizeMaxRows="5"></textarea>
    </mat-form-field>
  </div>
</ng-template>

<ng-template #templateOtros let-otro="otro">
  <div class="flex items-center w-full">
    <mat-checkbox color="primary" 
      (change)="setValueCheckedOtros(formGroup, $event)"
      [disabled] = "isCargaAdenda || rolePermisoCheckBox?.hasPermission"
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME"
      #rolePermisoCheckBox="vexOptionRoleCheck">
      <span>Otros documentos</span>
    </mat-checkbox>
    <span class="flex-1"></span>
    <span class="text-secondary" *ngIf="isReview || isReviewExt || isCargaAdenda">DjMock.pdf</span>
    <button *ngIf="isReview || isReviewExt || !isCargaAdenda" matTooltip="Descargar"
      mat-icon-button type="button"
      class="text-primary hover:bg-hover">
      <mat-icon svgIcon="mat:download" size="18px"></mat-icon>
    </button>
    <mat-radio-group
      *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME"
      [disabled] = "isCargaAdenda"
      [(ngModel)]="marcaOtros"
      class="ml-12 flex items-center gap-4">
      <mat-radio-button value="si">Sí</mat-radio-button>
      <mat-radio-button value="no">No</mat-radio-button>
    </mat-radio-group>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12">Evaluado por:</span>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12">Fecha y Hora:</span>
    <ng-container 
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME" 
      #rolePermisoSpan="vexOptionRoleCheck">
      <span *ngIf="!(rolePermisoSpan?.hasPermission)" class="flex-1">
      </span>
    </ng-container>
    
    <vex-form-adjuntos-btn class="ml-6" *ngIf="!(isReview || isReviewExt || isCargaAdenda)"
        [titulo]="'Archivo (*.pdf)'"
        [editable]="editable">
    </vex-form-adjuntos-btn>
  </div>
  <div *vexOptionRoleReemplazo="opcion.VIEW_OBS_INPUT"> 
    <mat-form-field class="w-full">
      <textarea matInput
             placeholder="Observación"
             [disabled] = "isCargaAdenda || !rolePermiso?.hasPermission"
             [vexOptionRoleCheck]="opcion.EDIT_OBS_INPUT"
             #rolePermiso="vexOptionRoleCheck"
             rows="2"
             cdkTextareaAutosize
             cdkAutosizeMinRows="2"
             cdkAutosizeMaxRows="5"></textarea>
    </mat-form-field>
  </div>
</ng-template>
