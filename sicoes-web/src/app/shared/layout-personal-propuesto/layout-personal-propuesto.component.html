<div class="w-full overflow-x-auto rounded items-center mb-6 mt-4" *ngIf="isReview || isReviewExt || isCargaAdenda">
  <table @stagger [dataSource]="listPersonalPropuestoReview" class="w-full table-auto" mat-table matSort>
    <ng-container matColumnDef="tipoDocumento">
      <th mat-header-cell *matHeaderCellDef mat-sort-header class="text-left">Tipo de<br>Documento</th>
      <td class="text-primary font-medium" mat-cell *matCellDef="let element">
        {{ element?.personaPropuesta?.tipoDocumento?.descripcion  }}</td>
    </ng-container>

    <ng-container matColumnDef="numeroDocumento">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Número de<br>Documento</th>
      <td class="text-primary font-medium" mat-cell *matCellDef="let element">
        {{ element?.personaPropuesta?.numeroDocumento }}</td>
    </ng-container>

    <ng-container matColumnDef="nombreCompleto">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombres y apellidos</th>
      <td class="text-primary font-medium break-words whitespace-normal min-w-[80px] py-2" mat-cell *matCellDef="let element">
        {{ getNombreCompleto(element?.personaPropuesta) }}</td>
    </ng-container>

    <ng-container matColumnDef="vacio">
      <td mat-footer-cell *matFooterCellDef colspan="9"
      class="text-center text-primary">
      No se encontraron registros
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumnsReview"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumnsReview"></tr>

    <tr mat-footer-row *matFooterRowDef="['vacio']"
      [class.hidden]="listPersonalPropuestoReview?.length > 0">
    </tr>
  </table>
</div>

<div class="flex flex-col sm:flex-row sm:gap-4 mt-4 items-start" *ngIf="!(isReview || isReviewExt || isCargaAdenda)">
  <mat-form-field class="flex-auto">
    <mat-label>Nombres y Apellidos</mat-label>
    <mat-select [formControl]="formGroup.controls.nombreCompleto">
      <mat-option [value]="null" [disabled]>Seleccione personal</mat-option>
      <mat-option *ngFor="let obj of listPersonalApto" [value]="obj">
        {{ getNombreCompleto(obj?.supervisora) }}
      </mat-option>
    </mat-select>
    <mat-error *ngIf="formGroup.get('nombreCompleto')?.hasError('required')">
      Seleccione personal
    </mat-error>
  </mat-form-field>
  <button color="primary" 
    mat-raised-button type="button" 
    (click)="guardarPersonalPropuesto()"
    [disabled] = "formGroup.invalid || listPersonalPropuesto.length > 0">
    Agregar
  </button>
</div>
<div>
    <ng-container *ngIf="mostrarTemplates" [ngTemplateOutlet]="templateNepotismo"></ng-container>
    <ng-container *ngIf="mostrarTemplates" [ngTemplateOutlet]="templateImpedimento"></ng-container>
    <ng-container *ngIf="mostrarTemplates" [ngTemplateOutlet]="templateNoVinculo"></ng-container>
    <ng-container *ngIf="mostrarTemplates" [ngTemplateOutlet]="templateOtros"></ng-container>
</div>

<div class="w-full overflow-x-auto shadow-2xl rounded" *ngIf="!(isReview || isReviewExt || isCargaAdenda)">
    <table @stagger [dataSource]="listPersonalPropuesto" class="w-full table-auto" mat-table matSort>
      <ng-container matColumnDef="tipoDocumento">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Tipo de<br>Documento</th>
        <td class="text-primary font-medium" mat-cell *matCellDef="let element">{{ element?.personaPropuesta?.tipoDocumento?.descripcion }}</td>
      </ng-container>

      <ng-container matColumnDef="numeroDocumento">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Número de<br>Documento</th>
        <td class="text-primary font-medium" mat-cell *matCellDef="let element">{{ element?.personaPropuesta?.numeroDocumento }}</td>
      </ng-container>

      <ng-container matColumnDef="nombreCompleto">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombres y apellidos</th>
        <td class="text-primary font-medium break-words whitespace-normal min-w-[100px] py-2" mat-cell *matCellDef="let element">
          {{ getNombreCompleto(element?.personaPropuesta) }}</td>
      </ng-container>

      <ng-container matColumnDef="djNepotismo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>DJ del personal<br>propuesto por la<br>empresa (Nepotismo)</th>
        <td class="text-primary font-medium" mat-cell *matCellDef="let element">
          <button mat-icon-button color="primary" (click)="descargar('DJ-NEPOTISMO')">
            <img *ngIf="tieneArchivo('DJ-NEPOTISMO')" class="w-6" src="assets/img/icons/logos/pdf-icon.png" alt="Logo PDF">
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="djImpedimento">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>DJ impedimentos /<br>incompatibilidad y<br>prohibiciones</th>
        <td class="text-primary font-medium" mat-cell *matCellDef="let element">
          <button mat-icon-button color="primary" (click)="descargar('DJ-IMPEDIMENTO')">
            <img *ngIf="tieneArchivo('DJ-IMPEDIMENTO')" class="w-6" src="assets/img/icons/logos/pdf-icon.png" alt="Logo PDF">
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="djNoVinculo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>DJ no vínculo<br>contractual con<br>agente supervisado</th>
        <td class="text-primary font-medium" mat-cell *matCellDef="let element">
          <button mat-icon-button color="primary" (click)="descargar('DJ-NO-VINCULO')">
            <img *ngIf="tieneArchivo('DJ-NO-VINCULO')" class="w-6" src="assets/img/icons/logos/pdf-icon.png" alt="Logo PDF">
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="otrosDocumentos">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Otros<br>documentos</th>
        <td class="text-primary font-medium" mat-cell *matCellDef="let element">
          <button mat-icon-button color="primary" (click)="descargar('OTROS')">
            <img *ngIf="tieneArchivo('OTROS')" class="w-6" src="assets/img/icons/logos/pdf-icon.png" alt="Logo PDF">
          </button>
        </td>
      </ng-container>

      <!-- Action Column -->

      <ng-container matColumnDef="actions">
        <th *matHeaderCellDef mat-header-cell mat-sort-header>Acciones</th>
        <td *matCellDef="let row" class="w-10 text-secondary" mat-cell>
          <button
            mat-icon-button
            type="button"
            (click)="eliminarPersonalPropuesto(row)">
            <mat-icon svgIcon="mat:delete"></mat-icon>
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="vacio">
        <td mat-footer-cell *matFooterCellDef colspan="9"
        class="text-center text-primary">
        No se encontraron registros
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <tr mat-footer-row *matFooterRowDef="['vacio']"
        [class.hidden]="listPersonalPropuesto?.length > 0">
      </tr>
    </table>
</div>

<ng-template #templateNepotismo let-otro="otro">
  <div class="flex items-center w-full">
    <mat-checkbox color="primary" 
    [checked]="adjuntoDjNepotismo?.adjunto?.archivo != null"
    (change)="setValueCheckedDjNepotismo(formGroup, $event)"
      [disabled] = "isCargaAdenda || rolePermisoCheckBox?.hasPermission"
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME"
      #rolePermisoCheckBox="vexOptionRoleCheck">
      <span>DJ del personal propuesto por la empresa (Nepotismo)</span>
    </mat-checkbox>
    <span class="flex-1"></span>

    <vex-form-adjuntos-no-title *ngIf="isReview || isReviewExt || isCargaAdenda"
      class="ml-auto"
      [adjuntoInput] = "adjuntoDjNepotismo"
      [editable]="editable">
    </vex-form-adjuntos-no-title>

    <mat-radio-group
      [disabled] = "isCargaAdenda || adjuntoDjNepotismo?.adjunto?.archivo == null"
      *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME"
      (change)="onMarcaDJNepotismoChange($event.value)"
      [(ngModel)]="marcaDjNepotismo"
      class="ml-12 flex items-center gap-4">
      <mat-radio-button value="SI">Sí</mat-radio-button>
      <mat-radio-button value="NO">No</mat-radio-button>
    </mat-radio-group>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12">
      {{djNepotismoEvaluadoPor || 'Evaluado por:'}}</span>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12 fecha-col">
      {{djNepotismoFechaHora || 'Fecha y Hora'}}</span>
    <ng-container 
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME" 
      #rolePermisoSpan="vexOptionRoleCheck">
      <span *ngIf="!(rolePermisoSpan?.hasPermission)" class="flex-1">
      </span>
    </ng-container>

    <vex-form-adjuntos-no-title *ngIf="!(isReview || isReviewExt || isCargaAdenda)"
      class="ml-auto"
      [idSeccion]="'982'"
      [idTipoDocumento]="'984'"
      [idReemplazoPersonal]="perfilBaja?.idReemplazo"
      [deNombreDocumento]="'DJ-NEPOTISMO'"
      [feFechaRegistro]="'21/07/2025'"
      [archivoDescripcion]="'Dj del personal propuesto por la empresa (Nepotismo)'"
      [editable]="editable"
      (archivoAdjuntado)="onDjNepotismoAdjunta($event)">
    </vex-form-adjuntos-no-title>
  </div>
  <div *vexOptionRoleReemplazo="opcion.VIEW_OBS_INPUT"> 
    <mat-form-field class="w-full">
      <textarea matInput
             placeholder="Observación"
             [disabled] = "isCargaAdenda || !rolePermiso?.hasPermission"
             [vexOptionRoleCheck]="opcion.EDIT_OBS_INPUT"
             #rolePermiso="vexOptionRoleCheck"
             rows="2"
             cdkTextareaAutosize
             cdkAutosizeMinRows="2"
             cdkAutosizeMaxRows="5"></textarea>
    </mat-form-field>
  </div>
</ng-template>


<ng-template #templateImpedimento let-otro="otro">
  <div class="flex items-center w-full">
    <mat-checkbox color="primary"
      [checked]="adjuntoDjImpedimento?.adjunto?.archivo != null"
      (change)="setValueCheckedDjImpedimento(formGroup, $event)"
      [disabled] = "isCargaAdenda || rolePermisoCheckBox?.hasPermission"
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME"
      #rolePermisoCheckBox="vexOptionRoleCheck">
      <span>DJ impedimentos / incompatibilidad y prohibiciones</span>
    </mat-checkbox>
    <span class="flex-1"></span>

    <vex-form-adjuntos-no-title *ngIf="isReview || isReviewExt || isCargaAdenda"
      class="ml-auto"
      [adjuntoInput] = "adjuntoDjImpedimento"
      [editable]="editable">
    </vex-form-adjuntos-no-title>
    
    <mat-radio-group
      *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME"
      [disabled] = "isCargaAdenda || adjuntoDjImpedimento?.adjunto?.archivo == null"
      (change)="onMarcaDJImpedimentoChange($event.value)"
      [(ngModel)]="marcaDjImpedimento"
      class="ml-12 flex items-center gap-4">
      <mat-radio-button value="SI">Sí</mat-radio-button>
      <mat-radio-button value="NO">No</mat-radio-button>
    </mat-radio-group>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12">
      {{djImpedimentoEvaluadoPor || 'Evaluado por:'}}</span>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12 fecha-col">
      {{djImpedimentoFechaHora || 'Fecha y Hora'}}</span>
    <ng-container 
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME" 
      #rolePermisoSpan="vexOptionRoleCheck">
      <span *ngIf="!(rolePermisoSpan?.hasPermission)" class="flex-1">
      </span>
    </ng-container>

    <vex-form-adjuntos-no-title *ngIf="!(isReview || isReviewExt || isCargaAdenda)"
      class="ml-auto"
      [idSeccion]="'982'"
      [idTipoDocumento]="'985'"
      [idReemplazoPersonal]="perfilBaja?.idReemplazo"
      [deNombreDocumento]="'DJ-IMPEDIMENTO'"
      [feFechaRegistro]="'21/07/2025'"
      [archivoDescripcion]="'Dj impedimentos / incompatibilidad y prohibiciones'"
      [editable]="editable"
      (archivoAdjuntado)="onDjImpedimentoAdjunta($event)">
    </vex-form-adjuntos-no-title>
  </div>
  <div *vexOptionRoleReemplazo="opcion.VIEW_OBS_INPUT"> 
    <mat-form-field class="w-full">
      <textarea matInput
             placeholder="Observación"
             [disabled] = "isCargaAdenda || !rolePermiso?.hasPermission"
             [vexOptionRoleCheck]="opcion.EDIT_OBS_INPUT"
             #rolePermiso="vexOptionRoleCheck"
             rows="2"
             cdkTextareaAutosize
             cdkAutosizeMinRows="2"
             cdkAutosizeMaxRows="5"></textarea>
    </mat-form-field>
  </div>
</ng-template>

<ng-template #templateNoVinculo let-otro="otro">
  <div class="flex items-center w-full">
    <mat-checkbox color="primary" 
      [checked]="adjuntoDjNoVinculo?.adjunto?.archivo != null"  
      (change)="setValueCheckedDjNoVinculo(formGroup, $event)"
      [disabled] = "isCargaAdenda || rolePermisoCheckBox?.hasPermission"
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME"
      #rolePermisoCheckBox="vexOptionRoleCheck">
      <span>DJ no vínculo contractual con agente supervisado</span>
    </mat-checkbox>
    <span class="flex-1"></span>

    <vex-form-adjuntos-no-title *ngIf="isReview || isReviewExt || isCargaAdenda"
      class="ml-auto"
      [adjuntoInput] = "adjuntoDjNoVinculo"
      [editable]="editable">
    </vex-form-adjuntos-no-title>
    
    <mat-radio-group
      *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME"
      [disabled] = "isCargaAdenda || adjuntoDjNoVinculo?.adjunto?.archivo == null"
      (change)="onMarcaDJNoVinculoChange($event.value)"
      [(ngModel)]="marcaDjNoVinculo"
      class="ml-12 flex items-center gap-4">
      <mat-radio-button value="SI">Sí</mat-radio-button>
      <mat-radio-button value="NO">No</mat-radio-button>
    </mat-radio-group>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12">
      {{djNoVinculoEvaluadoPor || 'Evaluado por:'}}</span>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12 fecha-col">
      {{djNoVinculoFechaHora || 'Fecha y Hora'}}</span>
    <ng-container 
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME" 
      #rolePermisoSpan="vexOptionRoleCheck">
      <span *ngIf="!(rolePermisoSpan?.hasPermission)" class="flex-1">
      </span>
    </ng-container>

    <vex-form-adjuntos-no-title *ngIf="!(isReview || isReviewExt || isCargaAdenda)"
      class="ml-auto"
      [idSeccion]="'982'"
      [idTipoDocumento]="'986'"
      [idReemplazoPersonal]="perfilBaja?.idReemplazo"
      [deNombreDocumento]="'DJ-NO-VINCULO'"
      [feFechaRegistro]="'21/07/2025'"
      [archivoDescripcion]="'Dj no vinculo contractual con agente supervisado'"
      [editable]="editable"
      (archivoAdjuntado)="onDjNoVinculoAdjunta($event)">
    </vex-form-adjuntos-no-title>
  </div>
  <div *vexOptionRoleReemplazo="opcion.VIEW_OBS_INPUT"> 
    <mat-form-field class="w-full">
      <textarea matInput
             placeholder="Observación"
             [disabled] = "isCargaAdenda || !rolePermiso?.hasPermission"
             [vexOptionRoleCheck]="opcion.EDIT_OBS_INPUT"
             #rolePermiso="vexOptionRoleCheck"
             rows="2"
             cdkTextareaAutosize
             cdkAutosizeMinRows="2"
             cdkAutosizeMaxRows="5"></textarea>
    </mat-form-field>
  </div>
</ng-template>

<ng-template #templateOtros let-otro="otro">
  <div class="flex items-center w-full">
    <mat-checkbox color="primary"
      [checked]="adjuntoOtros?.adjunto?.archivo != null"
      (change)="setValueCheckedOtros(formGroup, $event)"
      [disabled] = "isCargaAdenda || rolePermisoCheckBox?.hasPermission"
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME"
      #rolePermisoCheckBox="vexOptionRoleCheck">
      <span>Otros documentos</span>
    </mat-checkbox>
    <span class="flex-1"></span>

    <vex-form-adjuntos-no-title *ngIf="isReview || isReviewExt || isCargaAdenda"
      class="ml-auto"
      [adjuntoInput] = "adjuntoOtros"
      [editable]="editable">
    </vex-form-adjuntos-no-title>
    
    <mat-radio-group
      *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME"
      [disabled] = "isCargaAdenda || adjuntoOtros?.adjunto?.archivo == null"
      (change)="onMarcaOtrosChange($event.value)"
      [(ngModel)]="marcaOtros"
      class="ml-12 flex items-center gap-4">
      <mat-radio-button value="SI">SI</mat-radio-button>
      <mat-radio-button value="NO">NO</mat-radio-button>
    </mat-radio-group>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12">
      {{otrosEvaluadoPor || 'Evaluado por:'}}</span>
    <span *vexOptionRoleReemplazo="opcion.RAD_BTN_INFORME" class="text-secondary ml-12 fecha-col">
      {{otrosFechaHora || 'Fecha y Hora'}}</span>
    <ng-container 
      [vexOptionRoleCheck]="opcion.RAD_BTN_INFORME" 
      #rolePermisoSpan="vexOptionRoleCheck">
      <span *ngIf="!(rolePermisoSpan?.hasPermission)" class="flex-1">
      </span>
    </ng-container>
    
    <vex-form-adjuntos-no-title *ngIf="!(isReview || isReviewExt || isCargaAdenda)"
      class="ml-auto"
      [idSeccion]="'982'"
      [idTipoDocumento]="'987'"
      [idReemplazoPersonal]="perfilBaja?.idReemplazo"
      [deNombreDocumento]="'OTROS'"
      [feFechaRegistro]="'21/07/2025'"
      [archivoDescripcion]="'Otros documentos'"
      [editable]="editable"
      (archivoAdjuntado)="onOtrosAdjunta($event)">
    </vex-form-adjuntos-no-title>
  </div>
  <div *vexOptionRoleReemplazo="opcion.VIEW_OBS_INPUT"> 
    <mat-form-field class="w-full">
      <textarea matInput
             placeholder="Observación"
             [disabled] = "isCargaAdenda || !rolePermiso?.hasPermission"
             [vexOptionRoleCheck]="opcion.EDIT_OBS_INPUT"
             #rolePermiso="vexOptionRoleCheck"
             rows="2"
             cdkTextareaAutosize
             cdkAutosizeMinRows="2"
             cdkAutosizeMaxRows="5"></textarea>
    </mat-form-field>
  </div>
</ng-template>
